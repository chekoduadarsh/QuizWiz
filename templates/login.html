{% extends "base.html" %}

{% block title %}
QuizWiz | Login
{% endblock %}

{% block body %}
<script>
  function parseJwt(token) {
    var base64Url = token.split('.')[1];
    var base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
    var jsonPayload = decodeURIComponent(window.atob(base64).split('').map(function (c) {
      return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
    }).join(''));

    return JSON.parse(jsonPayload);
  };

  function onSignIn(response) {
    console.log("IN")
    const responsePayload = parseJwt(response.credential);

    console.log("ID: " + responsePayload.sub);
    console.log('Full Name: ' + responsePayload.name);
    console.log('Given Name: ' + responsePayload.given_name);
    console.log('Family Name: ' + responsePayload.family_name);
    console.log("Image URL: " + responsePayload.picture);
    console.log("Email: " + responsePayload.email);



    sessionStorage.setItem("Name", responsePayload.name);
    sessionStorage.setItem("Email", responsePayload.email);
    sessionStorage.setItem("Image URL", responsePayload.picture);

    form = document.getElementById('quickForm')
    document.getElementById('exampleInputEmail1').value=responsePayload.email
    var input = document.createElement("input");
    input.type = "text";
    input.name="name"
    input.className = "css-class-name"; // set the CSS class
    input.value = responsePayload.name
    form.appendChild(input); // put it into the DOM

    form.submit()

    
  }
</script>

<script src="https://accounts.google.com/gsi/client" async defer></script>


<!-- Main content -->
<section class="content">
  <div class="container-fluid">
    <div class="row">
      <!-- left column -->
      <div class="col-md-6" style="width: 21rem;height: 2.5rem; font-size: 1rem; position: relative; left: 300px;">
        <!-- jquery validation -->
        <div class="card card-primary">
          <div class="card-header" style="background-color: #343a40">
            <strong>
              <h1>Login</h1>
            </strong>
          </div>
          <!-- /.card-header -->
          <!-- form start -->
          <form id="quickForm" action="/onlogin" method="POST">
            <div class="card-body">
              <div class="form-group">
                <label for="exampleInputEmail1">Email address</label>
                <input type="email" name="email" class="form-control" id="exampleInputEmail1" placeholder="Email"
                  required>
              </div>
              <div class="form-group">
                <label for="exampleInputPassword1">Password</label>
                <input type="password" name="password" class="form-control" id="exampleInputPassword1"
                  placeholder="Password" required>
              </div>
              <div class="form-group mb-0" style="margin-top: 2.5rem;">
                <button type="submit" class="btn btn-primary" style=" position: relative; left: 250px">Login</button>
                <a class="button" href="/register" style=" position: relative; left: 250px">
                  <button type="button" class="btn btn-success">Register</button>
                </a>
              </div>

              <div id="g_id_onload"
                data-client_id="780139616874-3cfrhsn6r7gq4fj1oqck0utl60j4c4ln.apps.googleusercontent.com"
                data-context="signin" data-ux_mode="popup" data-login_uri="http://localhost:5000/"
                data-auto_prompt="false" data-callback="onSignIn">
              </div>

              <div class="g_id_signin" data-type="standard" data-shape="pill" data-theme="outline"
                data-text="signin_with" data-size="large" data-logo_alignment="left">
              </div>

            </div>
          </form>
        </div>
        <!-- /.card -->
      </div>
      <!--/.col (left) -->
      <!-- right column -->
      <div class="col-md-6">

      </div>
      <!--/.col (right) -->
    </div>
    <!-- /.row -->
  </div><!-- /.container-fluid -->
</section>
<!-- /.content -->
</div>
{% endblock %}


{% block navbar%}
<li class="nav-item">
<li class="nav-item">
  <a href="/register" class="nav-link">
    <p>
      Register
    </p>
  </a>
</li>
{% endblock %}